<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»‹è©å­¸ç¿’ App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .mode-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 1.1em;
        }

        .tab.small-tab {
            font-size: 0.95em;
            padding: 15px 10px;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }

        .preposition-select {
            margin-bottom: 30px;
        }

        .preposition-select label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .preposition-select select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .examples-list {
            margin-top: 30px;
        }

        .example-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .example-item h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .example-item p {
            margin: 5px 0;
            color: #555;
        }

        .example-item .delete-btn {
            background: #dc3545;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .example-item .edit-btn {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            margin-right: 10px;
            font-size: 0.9em;
        }

        .example-item .edit-btn:hover {
            background: #5568d3;
        }

        .example-item .delete-btn:hover {
            background: #c82333;
        }

        .edit-mode {
            background: #e7f3ff;
            border-left-color: #667eea;
        }

        .edit-form {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #667eea;
        }

        .edit-form input,
        .edit-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 0.95em;
        }

        .edit-form .btn-group {
            display: flex;
            gap: 10px;
        }

        .edit-form .btn-save {
            background: #28a745;
            color: white;
            flex: 1;
        }

        .edit-form .btn-cancel {
            background: #6c757d;
            color: white;
            flex: 1;
        }

        .batch-container {
            margin-top: 20px;
        }

        .batch-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
        }

        .batch-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .batch-table td {
            padding: 8px;
            border: 1px solid #e9ecef;
        }

        .batch-table input,
        .batch-table textarea,
        .batch-table select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95em;
            box-sizing: border-box;
        }

        .batch-table textarea {
            min-height: 60px;
            resize: vertical;
        }

        .batch-table select {
            cursor: pointer;
        }

        .batch-table .remove-row {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .batch-table .remove-row:hover {
            background: #c82333;
        }

        .batch-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .batch-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .batch-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .batch-info ul {
            margin-left: 20px;
            color: #666;
        }

        .batch-info ul li {
            margin: 5px 0;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .search-container {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-box input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-filters label {
            font-weight: 600;
            color: #666;
        }

        .search-filters select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
        }

        .search-results {
            margin-top: 20px;
        }

        .search-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .search-results-header h3 {
            color: #333;
            margin: 0;
        }

        .search-count {
            color: #667eea;
            font-weight: 600;
        }

        .search-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .search-item .prep-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .search-item .highlight {
            background: yellow;
            font-weight: 600;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .search-item-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .search-item-actions button {
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .btn-view {
            background: #667eea;
            color: white;
        }

        .btn-view:hover {
            background: #5568d3;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .header p {
                font-size: 0.9em;
            }

            .tab {
                padding: 15px 8px;
                font-size: 0.85em;
            }

            .tab.small-tab {
                font-size: 0.8em;
                padding: 12px 5px;
            }

            .content {
                padding: 15px;
            }

            .input-group input,
            .input-group textarea,
            .input-group select,
            .preposition-select select {
                font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
            }

            .btn {
                padding: 12px 20px;
                font-size: 0.95em;
                width: 100%;
                margin-bottom: 10px;
            }

            .action-buttons,
            .batch-actions {
                flex-direction: column;
            }

            .action-buttons .btn,
            .batch-actions .btn {
                width: 100%;
            }

            .stats {
                flex-direction: column;
                gap: 15px;
            }

            .stat-item {
                padding: 10px 0;
            }

            .quiz-sentence {
                font-size: 1.2em;
            }

            .preposition-buttons {
                gap: 8px;
            }

            .prep-btn {
                padding: 10px 18px;
                font-size: 0.95em;
            }

            .example-item,
            .wrong-item,
            .search-item {
                padding: 12px;
            }

            .example-item p,
            .wrong-item p,
            .search-item p {
                font-size: 0.95em;
                word-break: break-word;
            }

            .edit-form .btn-group {
                flex-direction: column;
            }

            .edit-form .btn-save,
            .edit-form .btn-cancel {
                width: 100%;
            }

            /* æ‰¹é‡è¼¸å…¥è¡¨æ ¼æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
            .batch-table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .batch-table thead {
                display: none;
            }

            .batch-table tbody {
                display: block;
            }

            .batch-table tr {
                display: block;
                margin-bottom: 15px;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                padding: 10px;
                background: white;
            }

            .batch-table td {
                display: block;
                border: none;
                padding: 8px 0;
            }

            .batch-table td:before {
                content: attr(data-label);
                font-weight: 600;
                display: block;
                margin-bottom: 5px;
                color: #667eea;
            }

            .batch-table input,
            .batch-table textarea {
                font-size: 16px;
            }

            /* æœå°‹åŠŸèƒ½æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
            .search-box {
                flex-direction: column;
            }

            .search-box input {
                font-size: 16px;
            }

            .search-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .search-filters select {
                width: 100%;
                font-size: 16px;
            }

            .search-results-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .search-item-actions {
                flex-direction: column;
            }

            .search-item-actions button {
                width: 100%;
            }

            .batch-info ul {
                font-size: 0.9em;
            }

            .mode-indicator {
                padding: 12px;
            }

            .mode-indicator h3 {
                font-size: 1.1em;
            }

            .mode-indicator p {
                font-size: 0.9em;
            }
        }

        /* è¶…å°è¢å¹•å„ªåŒ– */
        @media (max-width: 400px) {
            .header h1 {
                font-size: 1.5em;
            }

            .tab.small-tab {
                font-size: 0.75em;
                padding: 10px 3px;
            }

            .quiz-sentence {
                font-size: 1.1em;
            }

            .prep-btn {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }

        .quiz-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .quiz-sentence {
            font-size: 1.5em;
            margin-bottom: 30px;
            color: #333;
            line-height: 1.6;
        }

        .quiz-sentence .blank {
            display: inline-block;
            min-width: 80px;
            border-bottom: 3px solid #667eea;
            margin: 0 5px;
            font-weight: 700;
            color: #667eea;
        }

        .preposition-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .prep-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .prep-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .prep-btn.selected {
            background: #667eea;
            color: white;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-item .number {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-item .label {
            color: #666;
            margin-top: 5px;
        }

        .wrong-questions {
            margin-top: 30px;
        }

        .wrong-questions h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .wrong-item {
            background: #fff3cd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            position: relative;
        }

        .wrong-item .retry-btn {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .wrong-item .retry-btn:hover {
            background: #5568d3;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
        }

        .mode-indicator {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .mode-indicator h3 {
            color: #667eea;
            margin-bottom: 5px;
        }

        .mode-indicator p {
            color: #666;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š ä»‹è©å­¸ç¿’ App</h1>
            <p>æŒæ¡è‹±æ–‡ä»‹è©çš„æœ€ä½³å·¥å…·</p>
        </div>

        <div class="mode-tabs">
            <button class="tab small-tab active" onclick="switchMode('input')">ğŸ“ å–®å€‹è¼¸å…¥</button>
            <button class="tab small-tab" onclick="switchMode('batch')">ğŸ“Š æ‰¹é‡è¼¸å…¥</button>
            <button class="tab small-tab" onclick="switchMode('search')">ğŸ” æœå°‹ä¾‹å¥</button>
            <button class="tab small-tab" onclick="switchMode('practice')">âœï¸ ç·´ç¿’æ¨¡å¼</button>
        </div>

        <div class="content">
            <!-- è¼¸å…¥æ¨¡å¼ -->
            <div id="input-mode" class="mode-content active">
                <div class="preposition-select">
                    <label>é¸æ“‡ä»‹è©åˆ†é¡ï¼š</label>
                    <select id="prep-category" onchange="updateExamplesList()">
                        <option value="in">in</option>
                        <option value="on">on</option>
                        <option value="at">at</option>
                        <option value="by">by</option>
                        <option value="over">over</option>
                        <option value="with">with</option>
                        <option value="for">for</option>
                        <option value="within">within</option>
                        <option value="to">to</option>
                        <option value="of">of</option>
                        <option value="from">from</option>
                        <option value="about">about</option>
                        <option value="into">into</option>
                        <option value="as">as</option>
                        <option value="toward">toward</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>ä¾‹å¥ï¼ˆç”¨ ___ è¡¨ç¤ºä»‹è©ä½ç½®ï¼‰ï¼š</label>
                    <input type="text" id="example-sentence" placeholder="ä¾‹å¦‚ï¼šI live ___ Tokyo">
                </div>

                <div class="input-group">
                    <label>è§£é‡‹ï¼š</label>
                    <textarea id="example-explanation" placeholder="è§£é‡‹é€™å€‹ä»‹è©åœ¨æ­¤ä¾‹å¥ä¸­çš„ç”¨æ³•..."></textarea>
                </div>

                <button class="btn btn-primary" onclick="addExample()">â• æ–°å¢ä¾‹å¥</button>

                <div class="examples-list" id="examples-list">
                    <h3>å·²è¼¸å…¥çš„ä¾‹å¥</h3>
                    <div id="examples-container"></div>
                </div>
            </div>

            <!-- æ‰¹é‡è¼¸å…¥æ¨¡å¼ -->
            <div id="batch-mode" class="mode-content">
                <div class="batch-info">
                    <h3>ğŸ“Š æ‰¹é‡è¼¸å…¥èªªæ˜</h3>
                    <ul>
                        <li>å…ˆé¸æ“‡ä»‹è©ï¼Œç„¶å¾Œæ‰¹é‡è¼¸å…¥è©²ä»‹è©çš„å¤šå€‹ä¾‹å¥</li>
                        <li>æ¯è¡Œä»£è¡¨ä¸€å€‹ä¾‹å¥ï¼ŒåŒ…å«ä¾‹å¥å’Œè§£é‡‹</li>
                        <li>ä¾‹å¥ä¸­è«‹ç”¨ <strong>___</strong> è¡¨ç¤ºä»‹è©ä½ç½®</li>
                        <li>é»æ“Šã€Œæ–°å¢ä¸€è¡Œã€å¯ä»¥å¢åŠ æ›´å¤šä¾‹å¥</li>
                        <li>å„²å­˜å¾Œå¯ä»¥åˆ‡æ›åˆ°å…¶ä»–ä»‹è©ç¹¼çºŒè¼¸å…¥</li>
                    </ul>
                </div>

                <div class="preposition-select">
                    <label>é¸æ“‡ä»‹è©åˆ†é¡ï¼š</label>
                    <select id="batch-prep-category">
                        <option value="in">in</option>
                        <option value="on">on</option>
                        <option value="at">at</option>
                        <option value="by">by</option>
                        <option value="over">over</option>
                        <option value="with">with</option>
                        <option value="for">for</option>
                        <option value="within">within</option>
                        <option value="to">to</option>
                        <option value="of">of</option>
                        <option value="from">from</option>
                        <option value="about">about</option>
                        <option value="into">into</option>
                        <option value="as">as</option>
                        <option value="toward">toward</option>
                    </select>
                </div>

                <div class="batch-actions">
                    <button class="btn btn-secondary" onclick="addBatchRow()">â• æ–°å¢ä¸€è¡Œ</button>
                    <button class="btn btn-primary" onclick="saveBatchExamples()">ğŸ’¾ å„²å­˜å…¨éƒ¨</button>
                    <button class="btn btn-danger" onclick="clearBatchTable()">ğŸ—‘ï¸ æ¸…ç©ºè¡¨æ ¼</button>
                </div>

                <div class="batch-container">
                    <table class="batch-table">
                        <thead>
                            <tr>
                                <th style="width: 45%;">ä¾‹å¥ï¼ˆç”¨ ___ è¡¨ç¤ºä»‹è©ï¼‰</th>
                                <th style="width: 45%;">è§£é‡‹</th>
                                <th style="width: 80px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="batch-table-body">
                            <!-- æ‰¹é‡è¼¸å…¥çš„è¡Œæœƒå‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- æœå°‹æ¨¡å¼ -->
            <div id="search-mode" class="mode-content">
                <div class="search-container">
                    <div class="search-box">
                        <input type="text" id="search-input" placeholder="æœå°‹ä¾‹å¥æˆ–è§£é‡‹..." onkeyup="performSearch()">
                        <button class="btn btn-primary" onclick="performSearch()">ğŸ” æœå°‹</button>
                    </div>
                    
                    <div class="search-filters">
                        <label>ç¯©é¸ä»‹è©ï¼š</label>
                        <select id="search-prep-filter" onchange="performSearch()">
                            <option value="all">å…¨éƒ¨</option>
                            <option value="in">in</option>
                            <option value="on">on</option>
                            <option value="at">at</option>
                            <option value="by">by</option>
                            <option value="over">over</option>
                            <option value="with">with</option>
                            <option value="for">for</option>
                            <option value="within">within</option>
                            <option value="to">to</option>
                            <option value="of">of</option>
                            <option value="from">from</option>
                            <option value="about">about</option>
                            <option value="into">into</option>
                            <option value="as">as</option>
                            <option value="toward">toward</option>
                        </select>
                    </div>
                </div>

                <div class="search-results">
                    <div class="search-results-header">
                        <h3>æœå°‹çµæœ</h3>
                        <span class="search-count" id="search-count">å…± 0 å€‹çµæœ</span>
                    </div>
                    <div id="search-results-container">
                        <div class="no-results">
                            <p style="font-size: 1.2em;">ğŸ”</p>
                            <p>è¼¸å…¥é—œéµå­—é–‹å§‹æœå°‹</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç·´ç¿’æ¨¡å¼ -->
            <div id="practice-mode" class="mode-content">
                <div id="mode-indicator" class="mode-indicator">
                    <h3>ğŸ¯ ä¸€èˆ¬ç·´ç¿’æ¨¡å¼</h3>
                    <p>å¾æ‰€æœ‰å·²è¼¸å…¥çš„ä¾‹å¥ä¸­éš¨æ©Ÿå‡ºé¡Œ</p>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-warning" onclick="togglePracticeMode()">ğŸ”„ åˆ‡æ›éŒ¯é¡Œç·´ç¿’</button>
                    <button class="btn btn-danger" onclick="resetStats()">ğŸ—‘ï¸ æ¸…é™¤æˆç¸¾</button>
                </div>

                <div id="quiz-container">
                    <!-- é¡Œç›®æœƒå‹•æ…‹ç”Ÿæˆ -->
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="number" id="correct-count">0</div>
                        <div class="label">ç­”å°</div>
                    </div>
                    <div class="stat-item">
                        <div class="number" id="incorrect-count">0</div>
                        <div class="label">ç­”éŒ¯</div>
                    </div>
                    <div class="stat-item">
                        <div class="number" id="accuracy">0%</div>
                        <div class="label">æ­£ç¢ºç‡</div>
                    </div>
                </div>

                <div class="wrong-questions">
                    <h3>âŒ éŒ¯èª¤è¨˜éŒ„</h3>
                    <div id="wrong-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•¸æ“šå„²å­˜
        let data = {
            examples: {},
            stats: {
                correct: 0,
                incorrect: 0,
                wrongQuestions: []
            }
        };

        // æ‰€æœ‰ä»‹è©åˆ—è¡¨
        const allPrepositions = ['in', 'on', 'at', 'by', 'over', 'with', 'for', 'within', 'to', 'of', 'from', 'about', 'into', 'as', 'toward'];

        // ç•¶å‰ç·´ç¿’é¡Œ
        let currentQuestion = null;
        let selectedAnswer = null;

        // ç·´ç¿’æ¨¡å¼ç‹€æ…‹
        let isWrongQuestionMode = false;

        // æ­£åœ¨ç·¨è¼¯çš„ä¾‹å¥ID
        let editingId = null;

        // å¾ localStorage è¼‰å…¥æ•¸æ“š
        function loadData() {
            const saved = localStorage.getItem('prepositionAppData');
            if (saved) {
                data = JSON.parse(saved);
            }
            // åˆå§‹åŒ–æ‰€æœ‰ä»‹è©åˆ†é¡
            allPrepositions.forEach(prep => {
                if (!data.examples[prep]) {
                    data.examples[prep] = [];
                }
            });
        }

        // å„²å­˜æ•¸æ“šåˆ° localStorage
        function saveData() {
            localStorage.setItem('prepositionAppData', JSON.stringify(data));
        }

        // åˆ‡æ›æ¨¡å¼
        function switchMode(mode) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.mode-content').forEach(content => content.classList.remove('active'));
            
            if (mode === 'input') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('input-mode').classList.add('active');
                updateExamplesList();
            } else if (mode === 'batch') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('batch-mode').classList.add('active');
                initBatchTable();
            } else if (mode === 'search') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('search-mode').classList.add('active');
                performSearch();
            } else {
                document.querySelectorAll('.tab')[3].classList.add('active');
                document.getElementById('practice-mode').classList.add('active');
                startQuiz();
            }
        }

        // æ–°å¢ä¾‹å¥
        function addExample() {
            const category = document.getElementById('prep-category').value;
            const sentence = document.getElementById('example-sentence').value.trim();
            const explanation = document.getElementById('example-explanation').value.trim();

            if (!sentence || !explanation) {
                alert('è«‹å¡«å¯«ä¾‹å¥å’Œè§£é‡‹ï¼');
                return;
            }

            if (!sentence.includes('___')) {
                alert('ä¾‹å¥ä¸­è«‹ç”¨ ___ è¡¨ç¤ºä»‹è©ä½ç½®ï¼');
                return;
            }

            data.examples[category].push({
                sentence: sentence,
                explanation: explanation,
                preposition: category,
                id: Date.now()
            });

            saveData();
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('example-sentence').value = '';
            document.getElementById('example-explanation').value = '';
            
            updateExamplesList();
            alert('âœ… ä¾‹å¥æ–°å¢æˆåŠŸï¼');
        }

        // æ›´æ–°ä¾‹å¥åˆ—è¡¨
        function updateExamplesList() {
            const category = document.getElementById('prep-category').value;
            const container = document.getElementById('examples-container');
            const examples = data.examples[category] || [];

            if (examples.length === 0) {
                container.innerHTML = '<div class="empty-state">ğŸ“ é‚„æ²’æœ‰ä¾‹å¥ï¼Œé–‹å§‹æ–°å¢å§ï¼</div>';
                return;
            }

            container.innerHTML = examples.map(ex => {
                const isEditing = editingId === ex.id;
                return `
                    <div class="example-item ${isEditing ? 'edit-mode' : ''}">
                        <h4>${ex.preposition.toUpperCase()}</h4>
                        ${isEditing ? `
                            <div class="edit-form">
                                <input type="text" id="edit-sentence-${ex.id}" value="${ex.sentence}" placeholder="ä¾‹å¥ï¼ˆç”¨ ___ è¡¨ç¤ºä»‹è©ä½ç½®ï¼‰">
                                <textarea id="edit-explanation-${ex.id}" placeholder="è§£é‡‹">${ex.explanation}</textarea>
                                <div class="btn-group">
                                    <button class="btn btn-save" onclick="saveEdit(${ex.id})">ğŸ’¾ å„²å­˜</button>
                                    <button class="btn btn-cancel" onclick="cancelEdit()">âœ–ï¸ å–æ¶ˆ</button>
                                </div>
                            </div>
                        ` : `
                            <p><strong>ä¾‹å¥ï¼š</strong>${ex.sentence.replace('___', `<span style="color: #667eea; font-weight: 700;">${ex.preposition}</span>`)}</p>
                            <p><strong>è§£é‡‹ï¼š</strong>${ex.explanation}</p>
                            <button class="edit-btn" onclick="startEdit(${ex.id})">âœï¸ ç·¨è¼¯</button>
                            <button class="delete-btn" onclick="deleteExample(${ex.id})">ğŸ—‘ï¸ åˆªé™¤</button>
                        `}
                    </div>
                `;
            }).join('');
        }

        // åˆªé™¤ä¾‹å¥
        function deleteExample(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä¾‹å¥å—ï¼Ÿ')) return;

            for (let prep in data.examples) {
                data.examples[prep] = data.examples[prep].filter(ex => ex.id !== id);
            }
            saveData();
            updateExamplesList();
        }

        // é–‹å§‹ç·¨è¼¯ä¾‹å¥
        function startEdit(id) {
            editingId = id;
            updateExamplesList();
        }

        // å–æ¶ˆç·¨è¼¯
        function cancelEdit() {
            editingId = null;
            updateExamplesList();
        }

        // å„²å­˜ç·¨è¼¯
        function saveEdit(id) {
            const category = document.getElementById('prep-category').value;
            const sentence = document.getElementById(`edit-sentence-${id}`).value.trim();
            const explanation = document.getElementById(`edit-explanation-${id}`).value.trim();

            if (!sentence || !explanation) {
                alert('è«‹å¡«å¯«ä¾‹å¥å’Œè§£é‡‹ï¼');
                return;
            }

            if (!sentence.includes('___')) {
                alert('ä¾‹å¥ä¸­è«‹ç”¨ ___ è¡¨ç¤ºä»‹è©ä½ç½®ï¼');
                return;
            }

            // æ‰¾åˆ°ä¸¦æ›´æ–°ä¾‹å¥
            for (let prep in data.examples) {
                const exampleIndex = data.examples[prep].findIndex(ex => ex.id === id);
                if (exampleIndex !== -1) {
                    data.examples[prep][exampleIndex].sentence = sentence;
                    data.examples[prep][exampleIndex].explanation = explanation;
                    break;
                }
            }

            saveData();
            editingId = null;
            updateExamplesList();
            alert('âœ… ä¾‹å¥æ›´æ–°æˆåŠŸï¼');
        }

        // é–‹å§‹æ¸¬é©—
        function startQuiz() {
            let allExamples = [];

            // æ ¹æ“šæ¨¡å¼é¸æ“‡é¡Œç›®ä¾†æº
            if (isWrongQuestionMode) {
                // éŒ¯é¡Œç·´ç¿’æ¨¡å¼
                if (data.stats.wrongQuestions.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div class="empty-state">
                            <p style="font-size: 1.2em;">ğŸ‰ å¤ªæ£’äº†ï¼æ²’æœ‰éŒ¯é¡Œè¨˜éŒ„</p>
                            <p>é»æ“Šä¸Šæ–¹æŒ‰éˆ•åˆ‡æ›å›ä¸€èˆ¬ç·´ç¿’æ¨¡å¼</p>
                        </div>
                    `;
                    return;
                }
                allExamples = data.stats.wrongQuestions.slice();
            } else {
                // ä¸€èˆ¬ç·´ç¿’æ¨¡å¼
                for (let prep in data.examples) {
                    allExamples = allExamples.concat(data.examples[prep]);
                }

                if (allExamples.length === 0) {
                    document.getElementById('quiz-container').innerHTML = `
                        <div class="empty-state">
                            <p style="font-size: 1.2em;">é‚„æ²’æœ‰ä¾‹å¥å¯ä»¥ç·´ç¿’</p>
                            <p>è«‹å…ˆåˆ°è¼¸å…¥æ¨¡å¼æ–°å¢ä¾‹å¥ï¼</p>
                        </div>
                    `;
                    return;
                }
            }

            // éš¨æ©Ÿé¸ä¸€é¡Œ
            currentQuestion = allExamples[Math.floor(Math.random() * allExamples.length)];
            selectedAnswer = null;

            // ç”Ÿæˆé¸é …ï¼ˆæ­£ç¢ºç­”æ¡ˆ + å…¶ä»–éš¨æ©Ÿä»‹è©ï¼‰
            let options = [currentQuestion.preposition];
            let otherPreps = allPrepositions.filter(p => p !== currentQuestion.preposition);
            
            // éš¨æ©ŸåŠ å…¥ 3-4 å€‹å…¶ä»–é¸é …
            while (options.length < Math.min(5, allPrepositions.length)) {
                const randomPrep = otherPreps[Math.floor(Math.random() * otherPreps.length)];
                if (!options.includes(randomPrep)) {
                    options.push(randomPrep);
                }
            }

            // æ‰“äº‚é¸é …
            options.sort(() => Math.random() - 0.5);

            document.getElementById('quiz-container').innerHTML = `
                <div class="quiz-card">
                    <div class="quiz-sentence">
                        ${currentQuestion.sentence.replace('___', '<span class="blank">?</span>')}
                    </div>
                    <div class="preposition-buttons">
                        ${options.map(opt => `
                            <button class="prep-btn" onclick="selectAnswer('${opt}')">${opt}</button>
                        `).join('')}
                    </div>
                    <button class="btn btn-success" onclick="checkAnswer()" style="margin-top: 20px;">âœ“ ç¢ºèªç­”æ¡ˆ</button>
                    <div id="feedback"></div>
                </div>
            `;

            updateStats();
            updateWrongList();
        }

        // é¸æ“‡ç­”æ¡ˆ
        function selectAnswer(answer) {
            selectedAnswer = answer;
            document.querySelectorAll('.prep-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === answer) {
                    btn.classList.add('selected');
                }
            });
        }

        // æª¢æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            if (!selectedAnswer) {
                alert('è«‹å…ˆé¸æ“‡ä¸€å€‹ç­”æ¡ˆï¼');
                return;
            }

            const isCorrect = selectedAnswer === currentQuestion.preposition;
            const feedbackDiv = document.getElementById('feedback');

            if (isCorrect) {
                data.stats.correct++;
                feedbackDiv.className = 'feedback correct';
                feedbackDiv.innerHTML = `
                    <p style="font-size: 1.2em; margin-bottom: 10px;">âœ… ç­”å°äº†ï¼</p>
                    <p><strong>è§£é‡‹ï¼š</strong>${currentQuestion.explanation}</p>
                `;

                // å¦‚æœæ˜¯éŒ¯é¡Œç·´ç¿’æ¨¡å¼ä¸”ç­”å°ï¼Œå¾éŒ¯é¡Œåˆ—è¡¨ä¸­ç§»é™¤
                if (isWrongQuestionMode) {
                    data.stats.wrongQuestions = data.stats.wrongQuestions.filter(q => 
                        !(q.sentence === currentQuestion.sentence && 
                          q.preposition === currentQuestion.preposition)
                    );
                }
            } else {
                data.stats.incorrect++;
                
                // åªåœ¨ä¸€èˆ¬æ¨¡å¼ä¸‹è¨˜éŒ„æ–°éŒ¯é¡Œ
                if (!isWrongQuestionMode) {
                    // æª¢æŸ¥æ˜¯å¦å·²ç¶“å­˜åœ¨ç›¸åŒçš„éŒ¯é¡Œ
                    const exists = data.stats.wrongQuestions.some(q => 
                        q.sentence === currentQuestion.sentence && 
                        q.preposition === currentQuestion.preposition
                    );
                    
                    if (!exists) {
                        data.stats.wrongQuestions.push({
                            ...currentQuestion,
                            yourAnswer: selectedAnswer,
                            timestamp: new Date().toLocaleString()
                        });
                    }
                }
                
                feedbackDiv.className = 'feedback incorrect';
                feedbackDiv.innerHTML = `
                    <p style="font-size: 1.2em; margin-bottom: 10px;">âŒ ç­”éŒ¯äº†ï¼</p>
                    <p><strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong>${currentQuestion.preposition}</p>
                    <p><strong>ä½ çš„ç­”æ¡ˆï¼š</strong>${selectedAnswer}</p>
                    <p><strong>è§£é‡‹ï¼š</strong>${currentQuestion.explanation}</p>
                `;
            }

            saveData();

            setTimeout(() => {
                startQuiz();
            }, 3000);
        }

        // æ›´æ–°çµ±è¨ˆ
        function updateStats() {
            const total = data.stats.correct + data.stats.incorrect;
            const accuracy = total > 0 ? Math.round((data.stats.correct / total) * 100) : 0;

            document.getElementById('correct-count').textContent = data.stats.correct;
            document.getElementById('incorrect-count').textContent = data.stats.incorrect;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // æ›´æ–°éŒ¯èª¤åˆ—è¡¨
        function updateWrongList() {
            const container = document.getElementById('wrong-list');
            
            if (data.stats.wrongQuestions.length === 0) {
                container.innerHTML = '<div class="empty-state">ğŸ‰ ç›®å‰æ²’æœ‰éŒ¯èª¤è¨˜éŒ„ï¼</div>';
                return;
            }

            container.innerHTML = data.stats.wrongQuestions.slice(-10).reverse().map((q, index) => `
                <div class="wrong-item">
                    <p><strong>é¡Œç›®ï¼š</strong>${q.sentence}</p>
                    <p><strong>æ­£ç¢ºç­”æ¡ˆï¼š</strong><span style="color: #28a745; font-weight: 700;">${q.preposition}</span></p>
                    <p><strong>ä½ çš„ç­”æ¡ˆï¼š</strong><span style="color: #dc3545; font-weight: 700;">${q.yourAnswer}</span></p>
                    <p style="font-size: 0.9em; color: #666; margin-top: 5px;">${q.timestamp}</p>
                    <button class="retry-btn" onclick="practiceThisQuestion(${data.stats.wrongQuestions.length - 1 - index})">
                        ğŸ”„ ç·´ç¿’é€™é¡Œ
                    </button>
                </div>
            `).join('');
        }

        // ç·´ç¿’ç‰¹å®šéŒ¯é¡Œ
        function practiceThisQuestion(index) {
            const reversedIndex = data.stats.wrongQuestions.length - 1 - index;
            currentQuestion = data.stats.wrongQuestions[reversedIndex];
            selectedAnswer = null;

            // ç”Ÿæˆé¸é …
            let options = [currentQuestion.preposition];
            let otherPreps = allPrepositions.filter(p => p !== currentQuestion.preposition);
            
            while (options.length < Math.min(5, allPrepositions.length)) {
                const randomPrep = otherPreps[Math.floor(Math.random() * otherPreps.length)];
                if (!options.includes(randomPrep)) {
                    options.push(randomPrep);
                }
            }
            options.sort(() => Math.random() - 0.5);

            document.getElementById('quiz-container').innerHTML = `
                <div class="quiz-card">
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                        <strong>ğŸ“ æ­£åœ¨ç·´ç¿’éŒ¯é¡Œ</strong>
                    </div>
                    <div class="quiz-sentence">
                        ${currentQuestion.sentence.replace('___', '<span class="blank">?</span>')}
                    </div>
                    <div class="preposition-buttons">
                        ${options.map(opt => `
                            <button class="prep-btn" onclick="selectAnswer('${opt}')">${opt}</button>
                        `).join('')}
                    </div>
                    <button class="btn btn-success" onclick="checkAnswer()" style="margin-top: 20px;">âœ“ ç¢ºèªç­”æ¡ˆ</button>
                    <div id="feedback"></div>
                </div>
            `;

            // æ»¾å‹•åˆ°é¡Œç›®å€åŸŸ
            document.getElementById('quiz-container').scrollIntoView({ behavior: 'smooth' });
        }

        // åˆ‡æ›ç·´ç¿’æ¨¡å¼
        function togglePracticeMode() {
            isWrongQuestionMode = !isWrongQuestionMode;
            
            const indicator = document.getElementById('mode-indicator');
            if (isWrongQuestionMode) {
                indicator.innerHTML = `
                    <h3>âŒ éŒ¯é¡Œç·´ç¿’æ¨¡å¼</h3>
                    <p>å°ˆæ³¨ç·´ç¿’ä¹‹å‰ç­”éŒ¯çš„é¡Œç›®ï¼Œç­”å°å¾Œæœƒè‡ªå‹•å¾éŒ¯é¡Œæœ¬ç§»é™¤</p>
                `;
                indicator.style.borderLeftColor = '#ffc107';
                indicator.style.background = '#fff3cd';
            } else {
                indicator.innerHTML = `
                    <h3>ğŸ¯ ä¸€èˆ¬ç·´ç¿’æ¨¡å¼</h3>
                    <p>å¾æ‰€æœ‰å·²è¼¸å…¥çš„ä¾‹å¥ä¸­éš¨æ©Ÿå‡ºé¡Œ</p>
                `;
                indicator.style.borderLeftColor = '#667eea';
                indicator.style.background = '#e7f3ff';
            }
            
            startQuiz();
        }

        // é‡ç½®æˆç¸¾
        function resetStats() {
            if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æˆç¸¾è¨˜éŒ„å—ï¼Ÿ\nï¼ˆä¾‹å¥ä¸æœƒè¢«åˆªé™¤ï¼Œåªæœƒæ¸…é™¤ç­”é¡Œçµ±è¨ˆå’ŒéŒ¯é¡Œè¨˜éŒ„ï¼‰')) {
                return;
            }
            
            data.stats = {
                correct: 0,
                incorrect: 0,
                wrongQuestions: []
            };
            
            saveData();
            updateStats();
            updateWrongList();
            
            alert('âœ… æˆç¸¾å·²æ¸…é™¤ï¼å¯ä»¥é‡æ–°é–‹å§‹ç·´ç¿’äº†');
            
            // å¦‚æœåœ¨éŒ¯é¡Œæ¨¡å¼ï¼Œåˆ‡å›ä¸€èˆ¬æ¨¡å¼
            if (isWrongQuestionMode) {
                isWrongQuestionMode = false;
                const indicator = document.getElementById('mode-indicator');
                indicator.innerHTML = `
                    <h3>ğŸ¯ ä¸€èˆ¬ç·´ç¿’æ¨¡å¼</h3>
                    <p>å¾æ‰€æœ‰å·²è¼¸å…¥çš„ä¾‹å¥ä¸­éš¨æ©Ÿå‡ºé¡Œ</p>
                `;
                indicator.style.borderLeftColor = '#667eea';
                indicator.style.background = '#e7f3ff';
            }
            
            startQuiz();
        }

        // åˆå§‹åŒ–æ‰¹é‡è¼¸å…¥è¡¨æ ¼
        function initBatchTable() {
            const tbody = document.getElementById('batch-table-body');
            if (tbody.children.length === 0) {
                // é è¨­æ–°å¢3è¡Œ
                for (let i = 0; i < 3; i++) {
                    addBatchRow();
                }
            }
        }

        // æ–°å¢æ‰¹é‡è¼¸å…¥è¡Œ
        function addBatchRow() {
            const tbody = document.getElementById('batch-table-body');
            const rowId = Date.now() + Math.random();
            
            const row = document.createElement('tr');
            row.id = `batch-row-${rowId}`;
            row.innerHTML = `
                <td data-label="ä¾‹å¥">
                    <input type="text" class="batch-sentence" placeholder="ä¾‹å¦‚ï¼šI live ___ Tokyo">
                </td>
                <td data-label="è§£é‡‹">
                    <textarea class="batch-explanation" placeholder="è§£é‡‹é€™å€‹ä»‹è©çš„ç”¨æ³•..."></textarea>
                </td>
                <td data-label="æ“ä½œ" style="text-align: center;">
                    <button class="remove-row" onclick="removeBatchRow('${rowId}')">âŒ åˆªé™¤</button>
                </td>
            `;
            
            tbody.appendChild(row);
        }

        // ç§»é™¤æ‰¹é‡è¼¸å…¥è¡Œ
        function removeBatchRow(rowId) {
            const row = document.getElementById(`batch-row-${rowId}`);
            if (row) {
                row.remove();
            }
        }

        // æ¸…ç©ºæ‰¹é‡è¼¸å…¥è¡¨æ ¼
        function clearBatchTable() {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ•´å€‹è¡¨æ ¼å—ï¼Ÿ')) return;
            
            document.getElementById('batch-table-body').innerHTML = '';
            initBatchTable();
        }

        // å„²å­˜æ‰¹é‡è¼¸å…¥çš„ä¾‹å¥
        function saveBatchExamples() {
            const prep = document.getElementById('batch-prep-category').value;
            const tbody = document.getElementById('batch-table-body');
            const rows = tbody.querySelectorAll('tr');
            
            let validCount = 0;
            let errorCount = 0;
            const errors = [];

            rows.forEach((row, index) => {
                const sentence = row.querySelector('.batch-sentence').value.trim();
                const explanation = row.querySelector('.batch-explanation').value.trim();

                // è·³éç©ºè¡Œ
                if (!sentence && !explanation) {
                    return;
                }

                // æª¢æŸ¥æ ¼å¼
                if (!sentence || !explanation) {
                    errors.push(`ç¬¬ ${index + 1} è¡Œï¼šè«‹å¡«å¯«å®Œæ•´çš„ä¾‹å¥å’Œè§£é‡‹`);
                    errorCount++;
                    return;
                }

                if (!sentence.includes('___')) {
                    errors.push(`ç¬¬ ${index + 1} è¡Œï¼šä¾‹å¥ä¸­è«‹ç”¨ ___ è¡¨ç¤ºä»‹è©ä½ç½®`);
                    errorCount++;
                    return;
                }

                // å„²å­˜ä¾‹å¥
                data.examples[prep].push({
                    sentence: sentence,
                    explanation: explanation,
                    preposition: prep,
                    id: Date.now() + Math.random()
                });

                validCount++;
            });

            if (errorCount > 0) {
                alert('âŒ ç™¼ç¾éŒ¯èª¤ï¼š\n\n' + errors.join('\n') + '\n\nè«‹ä¿®æ­£å¾Œå†è©¦');
                return;
            }

            if (validCount === 0) {
                alert('âš ï¸ æ²’æœ‰å¯å„²å­˜çš„ä¾‹å¥ï¼ˆæ‰€æœ‰è¡Œéƒ½æ˜¯ç©ºçš„ï¼‰');
                return;
            }

            saveData();
            
            // æ¸…ç©ºè¡¨æ ¼
            document.getElementById('batch-table-body').innerHTML = '';
            initBatchTable();
            
            alert(`âœ… æˆåŠŸå„²å­˜ ${validCount} å€‹ "${prep}" çš„ä¾‹å¥ï¼\n\nå¯ä»¥ç¹¼çºŒé¸æ“‡å…¶ä»–ä»‹è©è¼¸å…¥æ›´å¤šä¾‹å¥`);
        }

        // åŸ·è¡Œæœå°‹
        function performSearch() {
            const searchTerm = document.getElementById('search-input').value.trim().toLowerCase();
            const prepFilter = document.getElementById('search-prep-filter').value;
            const resultsContainer = document.getElementById('search-results-container');
            const countElement = document.getElementById('search-count');

            let allExamples = [];

            // æ”¶é›†æ‰€æœ‰ä¾‹å¥
            for (let prep in data.examples) {
                if (prepFilter === 'all' || prepFilter === prep) {
                    allExamples = allExamples.concat(data.examples[prep].map(ex => ({
                        ...ex,
                        preposition: prep
                    })));
                }
            }

            // å¦‚æœæ²’æœ‰æœå°‹è©ï¼Œé¡¯ç¤ºæ‰€æœ‰ï¼ˆç¯©é¸å¾Œçš„ï¼‰ä¾‹å¥
            if (!searchTerm) {
                if (allExamples.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="no-results">
                            <p style="font-size: 1.2em;">ğŸ“</p>
                            <p>é‚„æ²’æœ‰ä¾‹å¥</p>
                        </div>
                    `;
                    countElement.textContent = 'å…± 0 å€‹çµæœ';
                    return;
                }

                displaySearchResults(allExamples, '');
                countElement.textContent = `å…± ${allExamples.length} å€‹çµæœ`;
                return;
            }

            // æœå°‹åŒ¹é…çš„ä¾‹å¥
            const results = allExamples.filter(ex => {
                const sentence = ex.sentence.toLowerCase();
                const explanation = ex.explanation.toLowerCase();
                return sentence.includes(searchTerm) || explanation.includes(searchTerm);
            });

            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <p style="font-size: 1.2em;">ğŸ˜”</p>
                        <p>æ‰¾ä¸åˆ°ç¬¦åˆçš„ä¾‹å¥</p>
                        <p style="font-size: 0.9em; color: #999;">è©¦è©¦å…¶ä»–é—œéµå­—æˆ–èª¿æ•´ç¯©é¸æ¢ä»¶</p>
                    </div>
                `;
                countElement.textContent = 'å…± 0 å€‹çµæœ';
            } else {
                displaySearchResults(results, searchTerm);
                countElement.textContent = `å…± ${results.length} å€‹çµæœ`;
            }
        }

        // é¡¯ç¤ºæœå°‹çµæœ
        function displaySearchResults(results, searchTerm) {
            const container = document.getElementById('search-results-container');
            
            container.innerHTML = results.map(ex => {
                // é«˜äº®é—œéµå­—
                const highlightText = (text, term) => {
                    if (!term) return text;
                    const regex = new RegExp(`(${term})`, 'gi');
                    return text.replace(regex, '<span class="highlight">$1</span>');
                };

                const highlightedSentence = highlightText(ex.sentence, searchTerm);
                const highlightedExplanation = highlightText(ex.explanation, searchTerm);
                const displaySentence = highlightedSentence.replace('___', `<span style="color: #667eea; font-weight: 700;">${ex.preposition}</span>`);

                return `
                    <div class="search-item">
                        <div class="prep-badge">${ex.preposition.toUpperCase()}</div>
                        <p><strong>ä¾‹å¥ï¼š</strong>${displaySentence}</p>
                        <p><strong>è§£é‡‹ï¼š</strong>${highlightedExplanation}</p>
                        <div class="search-item-actions">
                            <button class="btn-view" onclick="viewInInputMode('${ex.preposition}', ${ex.id})">ğŸ“ å‰å¾€ç·¨è¼¯</button>
                            <button class="btn-view" onclick="practiceThisSearchResult(${ex.id}, '${ex.preposition}')">ğŸ¯ ç·´ç¿’é€™é¡Œ</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åœ¨è¼¸å…¥æ¨¡å¼ä¸­æŸ¥çœ‹ç‰¹å®šä¾‹å¥
        function viewInInputMode(prep, exampleId) {
            // åˆ‡æ›åˆ°è¼¸å…¥æ¨¡å¼
            document.getElementById('prep-category').value = prep;
            switchMode('input');
            
            // æ»¾å‹•åˆ°è©²ä¾‹å¥
            setTimeout(() => {
                const exampleItems = document.querySelectorAll('.example-item');
                exampleItems.forEach(item => {
                    if (item.querySelector('h4').textContent === prep.toUpperCase()) {
                        // æ‰¾åˆ°å°æ‡‰çš„ä¾‹å¥ï¼Œå¯ä»¥åŠ å…¥é«˜äº®æ•ˆæœ
                        item.style.backgroundColor = '#fff3cd';
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // 3ç§’å¾Œç§»é™¤é«˜äº®
                        setTimeout(() => {
                            item.style.backgroundColor = '';
                        }, 3000);
                    }
                });
            }, 100);
        }

        // å¾æœå°‹çµæœç·´ç¿’ç‰¹å®šé¡Œç›®
        function practiceThisSearchResult(exampleId, prep) {
            // æ‰¾åˆ°è©²ä¾‹å¥
            const example = data.examples[prep].find(ex => ex.id === exampleId);
            if (!example) return;

            // åˆ‡æ›åˆ°ç·´ç¿’æ¨¡å¼
            switchMode('practice');

            // è¨­ç½®ç•¶å‰é¡Œç›®
            setTimeout(() => {
                currentQuestion = example;
                selectedAnswer = null;

                // ç”Ÿæˆé¸é …
                let options = [example.preposition];
                let otherPreps = allPrepositions.filter(p => p !== example.preposition);
                
                while (options.length < Math.min(5, allPrepositions.length)) {
                    const randomPrep = otherPreps[Math.floor(Math.random() * otherPreps.length)];
                    if (!options.includes(randomPrep)) {
                        options.push(randomPrep);
                    }
                }
                options.sort(() => Math.random() - 0.5);

                document.getElementById('quiz-container').innerHTML = `
                    <div class="quiz-card">
                        <div style="background: #e7f3ff; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                            <strong>ğŸ” å¾æœå°‹çµæœç·´ç¿’</strong>
                        </div>
                        <div class="quiz-sentence">
                            ${example.sentence.replace('___', '<span class="blank">?</span>')}
                        </div>
                        <div class="preposition-buttons">
                            ${options.map(opt => `
                                <button class="prep-btn" onclick="selectAnswer('${opt}')">${opt}</button>
                            `).join('')}
                        </div>
                        <button class="btn btn-success" onclick="checkAnswer()" style="margin-top: 20px;">âœ“ ç¢ºèªç­”æ¡ˆ</button>
                        <div id="feedback"></div>
                    </div>
                `;

                // æ»¾å‹•åˆ°é¡Œç›®å€åŸŸ
                document.getElementById('quiz-container').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        // åˆå§‹åŒ–
        loadData();
        updateExamplesList();
    </script>
</body>
</html>